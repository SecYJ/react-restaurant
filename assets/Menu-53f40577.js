import{r as c,j as e,F as m,a as o}from"./jsx-runtime-00d1b5d3.js";import{u}from"./MenuCtx-72856c34.js";import{u as N}from"./CartCtx-6851d5f1.js";import{b as w,d as S}from"./index.esm-a48567f3.js";import{u as v}from"./useMediaQuery-ba868550.js";import{B as C}from"./Button-3887cb91.js";import{u as y}from"./useFoodMenu-de313611.js";import{z as _}from"./QueryClientProvider-d549d0a2.js";import{a as b}from"./router-2fbab9ae.js";import{m as k}from"./motion-7a035700.js";const f=(r,s)=>{const t=r.indexOf("limit_1");return`${r.slice(0,t)}h_${s},${r.slice(t)}`},M=({src:r,alt:s})=>{const t=c.useRef(null),[l,a]=c.useState(!1);return c.useEffect(()=>{const n=p=>{p[0].isIntersecting&&a(!0)},i=new IntersectionObserver(n,{threshold:.2});return i.observe(t.current),()=>i.disconnect()},[]),e(m,{children:l?o("picture",{children:[e("source",{type:"image/webp",media:"(min-width: 1024px)",srcSet:f(r,350)}),e("source",{type:"image/webp",media:"(min-width: 0px)",srcSet:f(r,300)}),e("img",{src:"https://asset.alacarte.my/assets/img/alacarte-default-4.png?x-oss-process=image/resize,w_300,limit_1/format,webp",alt:s,className:"h-full w-full object-cover lg:h-[300px]"})]}):e("img",{ref:t,className:"h-full w-full object-cover"})})},R=({img:r,category:s,price:t,name:l,stock:a,id:n})=>{const{dispatch:i}=N(),[p,...x]=l.split(" "),g=v("(min-width: 1024px)"),h=()=>{i({type:"ADD_TO_CART",payload:{price:t,name:l,id:n,stock:a,img:r}})};return o("li",{className:"relative grid grid-cols-[auto_1fr] overflow-hidden rounded-lg border border-gray-200 duration-150 hover:-translate-y-1 hover:border-gray-400 hover:shadow-xl lg:grid-cols-1 lg:grid-rows-[auto_1fr]","data-id":n,children:[e("div",{className:"w-24 overflow-hidden lg:w-auto",children:e(M,{src:r,alt:l})}),o("div",{className:"grid grid-cols-[1fr_auto] content-between p-2",children:[g?o(m,{children:[o("p",{className:"flex items-center font-semibold",children:[p,e("span",{className:"badge-secondary badge ml-2",children:s})]}),o("strong",{className:"text-3xl text-primary",children:["RM ",t.toFixed(2)]}),e("p",{className:"text-lg font-semibold",children:x.join(" ")})]}):o(m,{children:[e("p",{className:"col-span-full",children:l}),e("span",{className:"badge-secondary badge col-span-full",children:s}),o("strong",{className:"text-primary",children:["RM ",t.toFixed(2)]})]}),g?e(C,{color:"secondary",className:"btn-lg col-span-full mt-3",onClick:h,children:"加入购物车"}):e("button",{type:"button",className:"grid h-6 w-6 place-items-center self-end rounded-full border border-primary bg-primary",onClick:h,children:e(w,{color:"white"})})]})]})},d=({type:r="text",classes:s})=>{let t=null;r==="img"&&(t="h-[300px]"),r==="title"&&(t="h-5 my-3"),r==="text"&&(t="h-3 my-2");const l=`bg-gray-300 rounded-md animate-pulse ${t} ${s}`;return e("div",{className:l})},E=()=>o("div",{className:"rounded-md bg-gray-500",children:[e(d,{type:"img"}),o("div",{className:"p-4",children:[e(d,{type:"title",classes:"w-full"}),e(d,{type:"text",classes:"w-3/4"}),e(d,{type:"text",classes:"w-3/4"})]})]}),T=()=>e("ul",{className:"grid grid-cols-3 gap-8",children:[...Array(12).keys()].map(r=>e(E,{},r))}),A=()=>{const{dispatch:r,filtered_menu:s,search:t}=u(),{isLoading:l}=y({onSuccess:a=>r({type:"SET_MENU",payload:a})});return l?e(T,{}):s.length<1&&t!==""?e("p",{children:"没有符合您寻找的食品，请在查询"}):e("ul",{className:"grid gap-4 md:grid-cols-2 md:gap-6 lg:grid-cols-3 lg:gap-8",children:s.map(a=>c.createElement(R,{...a,key:a.id}))})},O=(r="",s=1e3)=>{const[t,l]=c.useState(r);return c.useEffect(()=>{const a=setTimeout(()=>{l(r)},s);return()=>clearTimeout(a)},[r,s]),t},j=({search:r,onSearchChange:s})=>{const t=c.useId(),{filtered_menu:l}=u(),a=c.useRef(null),n=()=>{s(""),a.current.focus()};return o("form",{className:"relative mb-4 rounded-md",children:[e("input",{type:"text",className:"mx-auto w-full rounded-md border border-gray-300 p-3 text-base outline-none focus:border-primary",placeholder:"搜寻",disabled:l.length<1,id:t,onChange:i=>{s(i.target.value)},value:r,ref:a}),e("label",{htmlFor:t,className:"absolute top-1/2 right-2 -translate-y-1/2 ",children:r?e("button",{type:"button",onClick:n,children:e(S,{})}):e(_,{})})]})},F=()=>{const{currentSelect:r,dispatch:s}=u(),{isLoading:t,data:l}=y();if(t)return[...Array(5).keys()].map(n=>e(d,{classes:"h-14"},n));const a=["全部",...new Set(l.map(n=>n.category))];return e(m,{children:e("ul",{className:"menu flex-row lg:flex-col",children:a.map(n=>e("li",{className:r===n?"bordered":"",children:e("button",{type:"button",onClick:()=>{s({type:"SORT_BY_CATEGORY",payload:n})},className:`${r===n?"border-b-4 border-l-0 bg-primary/20 text-black/70 enabled:hover:bg-primary/20 lg:border-l-4 lg:border-b-0":"border-b-4 border-transparent bg-transparent text-black/70 enabled:hover:bg-primary/20 lg:border-l-4 lg:border-b-0"}`,children:n})},n))})})},I=()=>{const{dispatch:r,filtered_menu:s}=u(),[t,l]=c.useState(""),a=O(t,750);return c.useEffect(()=>{r({type:"SEARCH_PRODUCTS",payload:a}),r({type:"SET_SEARCH",payload:a})},[a]),o(m,{children:[e(j,{onSearchChange:l,search:t}),a!==""&&o("p",{children:["搜寻到 ",s.length," 个菜色"]}),a===""&&e(F,{})]})},Y=()=>e(k.main,{variants:b,...b,className:"container my-10 lg:my-20",children:o("div",{className:"flex flex-col gap-8 lg:flex-row",children:[e("div",{className:"sticky left-0 top-16 z-[1] bg-white pb-4 lg:top-[160px] lg:h-full lg:w-1/4",children:e(I,{})}),o("div",{className:"lg:w-3/4",children:[e("h1",{className:"mb-3 text-2xl lg:mb-6 lg:text-4xl",children:"菜单列表"}),e(A,{})]})]})});export{Y as default};
